# Please refer to `README.md` for how to setup this GitHub action runner
version: "3.9"

services:
  runner:
    image: ghcr.io/actions/actions-runner:2.328.0
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    deploy:
      replicas: 4
    restart: always
    environment:
      RUNNER_ALLOW_RUNASROOT: "1"
    privileged: true
    user: root
    # ref: https://github.com/actions/runner/issues/367#issuecomment-2007558723
    # ref: https://github.com/actions/runner
    entrypoint: >
      sh -c "
      ./config.sh --url ${GITHUB_RUNNER_URL} --token ${GITHUB_RUNNER_TOKEN} --unattended &&
      ./run.sh
      "
